<!DOCTYPE html>
<html lang="en">
<head>
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">-->
        <link rel="stylesheet" href="bootstrap.min.css">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Delete Users</title>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="index.html">zoom api</a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="index.html">generate token</a></li>
                <li class="nav-item"><a class="nav-link" href="list_users.html">list users</a></li>
                <li class="nav-item"><a class="nav-link active" href="delete_users.html">delete users</a></li>
                <li class="nav-item"><a class="nav-link" href="extra_commands.html">extra command</a></li>
                <li class="nav-item"><a class="nav-link" href="README.html">README</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-5">
    <h1 class="text-center">Delete Users</h1>
    <form id="deleteUsersForm" enctype="multipart/form-data">
        <div class="mb-5">
            <label for="bearer_token" class="form-label">Bearer Token</label>
            <input type="text" class="form-control" id="bearer_token" name="bearer_token" required>
        </div>
        <div class="mb-5">
            <label for="csv_file" class="form-label">Upload CSV File</label>
            <input type="file" class="form-control" id="csv_file" name="csv_file" accept=".csv" required>
        </div>
        <button type="submit" class="btn btn-danger w-100">DELETE USERS</button>
    </form>
    <div id="deleteStatus" class="mt-3" style="max-height: 500px; overflow-y: auto;"></div>
</div>

<script>
document.getElementById("deleteUsersForm").addEventListener("submit",async e=>{e.preventDefault();let t=new FormData,r=document.getElementById("bearer_token").value,s=document.getElementById("csv_file").files[0],n=document.getElementById("deleteStatus");if(!r||!s){n.innerHTML='<p class="text-danger">All fields are required.</p>';return}t.append("bearer_token",r),t.append("csv_file",s),n.innerHTML="";try{let l=await fetch("delete_users.php",{method:"POST",body:t});if(!l.body)throw Error("Streaming not supported");let a=l.body.getReader(),o=new TextDecoder,d="";for(;;){let{done:i,value:g}=await a.read();if(i)break;d+=o.decode(g,{stream:!0});let p=d.split("\n");for(let u of(d=p.pop(),p)){let c=u.trim();if(c.startsWith("{"))try{let f=JSON.parse(c);updateStatus(f,n)}catch(m){console.warn("Parse error:",m,u)}}}}catch(y){y.message.includes("abort")||(n.innerHTML+=`<p class="text-danger"><strong>Error:</strong> ${y.message}</p>`)}});function updateStatus(e,t){let r="progressLine",s=document.getElementById(r);if(e.error){t.innerHTML+=`<p class="text-danger"><strong>Error:</strong> ${e.error}</p>`;return}if("start"===e.status){t.innerHTML+=`<p>Starting deletion of <strong>${e.total}</strong> users...</p>`,t.innerHTML+=`<div class="progress mb-3">
            <div id="progressBar" class="progress-bar bg-danger" style="width:0%">0/${e.total}</div>
        </div>`,t.innerHTML+=`<p id="${r}" class="text-muted small">
        Waiting for first result...
        </p>`;return}if("progress"===e.status){let n=document.getElementById("progressBar");if(n){let l=Math.round(e.current/e.total*100);n.style.width=`${l}%`,n.textContent=`${e.current}/${e.total}`}let a=e.success?"-":"+",o=e.success?"Deleted":e.response&&JSON.parse(e.response)?.message||e.httpCode;s||(s=document.getElementById(r)),s&&(s.innerHTML=`
                Processing <strong>${e.current}</strong> of <strong>${e.total}</strong> |
                Last: <strong>${e.identifier}</strong> ${a} (${o}) |
                <span class="text-success">Deleted: ${e.deleted}</span>
            `),t.scrollTop=0;return}if("complete"===e.status){let d=e.deleted>0?"success":"warning",i=e.deleted===e.total?`All ${e.deleted} users deleted!`:`${e.deleted} of ${e.total} deleted.`;t.innerHTML+=`<p class="text-${d} mt-3"><strong>${i}</strong></p>`;return}}
</script>



</body>
</html>
